[BITS 32]

[GLOBAL start]
[EXTERN code]
[EXTERN bss]
[EXTERN end]
[EXTERN main]

;; Multiboot constants

	MULTIBOOT_SEARCH 		equ 8192
	MULTIBOOT_HEADER_MAGIC 		equ 0x1BADB002
	MULTIBOOT_BOOTLOADER_MAGIC 	equ 0x2BADB002
	MULTIBOOT_UNSUPPORTED 		equ 0x0000fffc
	MULTIBOOT_MOD_ALIGN 		equ 0x00001000
	MULTIBOOT_INFO_ALIGN 		equ 0x00000004
	
;; Flags for multiboot header

	MULTIBOOT_PAGE_ALIGN            equ 0x00000001
	MULTIBOOT_MEMORY_INFO           equ 0x00000002
	MULTIBOOT_VIDEO_MODE            equ 0x00000004
	MULTIBOOT_AOUT_KLUDGE           equ 0x00010000

;; Flags for multiboot info

	MULTIBOOT_INFO_MEMORY 		equ 0x00000001
	MULTIBOOT_INFO_BOOTDEV 		equ 0x00000002
	MULTIBOOT_INFO_CMDLINE 		equ 0x00000004
	MULTIBOOT_INFO_MODS             equ 0x00000008
	MULTIBOOT_INFO_AOUT_SYMS 	equ 0x00000010
	MULTIBOOT_INFO_ELF_SHDR 	equ 0x00000020
	MULTIBOOT_INFO_MEM_MAP 		equ 0x00000040
	MULTIBOOT_INFO_DRIVE_INFO 	equ 0x00000080
	MULTIBOOT_INFO_CONFIG_TABLE 	equ 0x00000100
	MULTIBOOT_INFO_BOOT_LOADER_NAME equ 0x00000200
	MULTIBOOT_INFO_APM_TABLE 	equ 0x00000400
	MULTIBOOT_INFO_VIDEO_INFO 	equ 0x00000800

;; Configuration
	MULTIBOOT_FLAGS                 equ MULTIBOOT_PAGE_ALIGN | MULTIBOOT_MEMORY_INFO
	MULTIBOOT_CHECKSUM              equ -(MULTIBOOT_HEADER_MAGIC + MULTIBOOT_FLAGS)

MULTIBOOT_HEADER:
	dd MULTIBOOT_HEADER_MAGIC
	dd MULTIBOOT_FLAGS
	dd MULTIBOOT_CHECKSUM

	dd MULTIBOOT_HEADER
	dd code
	dd bss
	dd end
	dd start

start:
	push ebx

	cli
	call main

idle:
	hlt
	jmp idle
